<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AgriAssist — Farmer MVP</title>
  <!-- Tailwind via CDN for quick prototype -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* small helper to make cards look nicer */
    .card { @apply bg-white rounded-2xl shadow-md p-4; }
  </style>
</head>
<body class="bg-slate-50 min-h-screen font-sans text-slate-800">
  <div class="max-w-5xl mx-auto p-4">
    <!-- Header -->
    <header class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-3">
        <svg class="w-10 h-10 text-green-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C13.1046 2 14 2.89543 14 4V6H16C17.1046 6 18 6.89543 18 8V15C18 17.2091 16.2091 19 14 19H10C7.79086 19 6 17.2091 6 15V8C6 6.89543 6.89543 6 8 6H10V4C10 2.89543 10.8954 2 12 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <div>
          <h1 id="t-app-title" class="text-xl font-semibold">AgriAssist</h1>
          <p id="t-app-sub" class="text-xs text-slate-500">Data-driven insights for small-scale farmers</p>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <label for="lang" class="text-sm text-slate-600">Language</label>
        <select id="lang" class="border rounded px-2 py-1" onchange="setLang(this.value)">
          <option value="en">English</option>
          <option value="hi">हिन्दी (Hindi)</option>
          <option value="bn">বাংলা (Bengali)</option>
          <option value="te">తెలుగు (Telugu)</option>
        </select>
      </div>
    </header>

    <!-- Main grid -->
    <main class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <!-- Left column: farmer summary -->
      <section class="md:col-span-2 space-y-4">
        <div class="card">
          <div class="flex justify-between items-start">
            <div>
              <h2 id="t-forecast-title" class="text-lg font-semibold">Field Forecasts</h2>
              <p id="t-forecast-sub" class="text-sm text-slate-500">Per-field yield predictions and tailored actions</p>
            </div>
            <button class="px-3 py-1 bg-green-600 text-white rounded" onclick="simulateBoost()" id="t-simulate">Simulate +10% boost</button>
          </div>

          <!-- field list -->
          <div class="mt-4 space-y-3" id="fieldList"></div>

          <!-- upload CSV (mock) -->
          <div class="mt-4 border-t pt-3 text-sm text-slate-600 flex flex-col md:flex-row gap-2 md:items-center">
            <div>
              <label id="t-upload-label">Upload field CSV</label>
              <p class="text-xs text-slate-400">(columns: field_id,crop,area_ha,last_yield_kg_per_ha,soil_n_ppm)</p>
            </div>
            <input id="csvFile" type="file" accept=".csv" class="ml-auto" onchange="handleCSV(event)" />
          </div>
        </div>

        <!-- recommendations & explanations -->
        <div class="card">
          <h3 id="t-rec-title" class="font-semibold">Top recommendations</h3>
          <div id="recommendations" class="mt-3 space-y-3 text-sm"></div>
        </div>
      </section>

      <!-- Right column: KPIs & quick actions -->
      <aside class="space-y-4">
        <div class="card">
          <h3 id="t-kpi-title" class="font-semibold">KPIs</h3>
          <div class="mt-3 grid grid-cols-2 gap-3 text-center">
            <div class="p-2 border rounded">
              <div class="text-xs text-slate-500">Avg Yield</div>
              <div id="avgYield" class="text-lg font-bold">— kg/ha</div>
            </div>
            <div class="p-2 border rounded">
              <div class="text-xs text-slate-500">Est. Uplift</div>
              <div id="estUplift" class="text-lg font-bold">— %</div>
            </div>
            <div class="p-2 border rounded col-span-2">
              <div class="text-xs text-slate-500">Fields Tracked</div>
              <div id="numFields" class="text-lg font-bold">0</div>
            </div>
          </div>
        </div>

        <div class="card">
          <h4 id="t-quick-actions" class="font-semibold">Quick Actions</h4>
          <div class="mt-3 flex flex-col gap-2">
            <button id="t-add-sample" onclick="loadSampleData()" class="w-full px-3 py-2 border rounded">Load sample data</button>
            <button id="t-export" onclick="exportCSV()" class="w-full px-3 py-2 bg-slate-800 text-white rounded">Export recommendations</button>
          </div>
        </div>

        <div class="card text-xs text-slate-500">
          <p id="t-footnote">This prototype runs inference client-side and demonstrates localization and a simple prescriptive rule system. Production: hook to a backend and model service.</p>
        </div>
      </aside>
    </main>
  </div>

  <script>
    // Simple in-browser "i18n" strings. Extend and move to JSON files for production.
    const I18N = {
      en: {
        "app_title": "AgriAssist",
        "app_sub": "Data-driven insights for small-scale farmers",
        "forecast_title": "Field Forecasts",
        "forecast_sub": "Per-field yield predictions and tailored actions",
        "simulate": "Simulate +10% boost",
        "upload_label": "Upload field CSV",
        "rec_title": "Top recommendations",
        "kpi_title": "KPIs",
        "quick_actions": "Quick Actions",
        "add_sample": "Load sample data",
        "export": "Export recommendations",
        "footnote": "This prototype runs inference client-side and demonstrates localization and a simple prescriptive rule system. Production: hook to a backend and model service."
      },
      hi: {
        "app_title": "एग्रीअसिस्ट",
        "app_sub": "छोटे किसानों के लिए डाटा-आधारित सुझाव",
        "forecast_title": "खेत भविष्यवाणियाँ",
        "forecast_sub": "प्रति-खेत पैदावार पूर्वानुमान और सुझाव",
        "simulate": "+10% प्रभाव दिखाएँ",
        "upload_label": "CSV अपलोड करें",
        "rec_title": "शीर्ष अनुशंसाएँ",
        "kpi_title": "प्रदर्शन संकेतक",
        "quick_actions": "त्वरित क्रियाएँ",
        "add_sample": "नमूना डेटा डालें",
        "export": "अनुशंसाएँ एक्सपोर्ट करें",
        "footnote": "यह प्रोटोटाइप क्लाइंट-साइड रन करता है और स्थानीयकरण व सरल नियम-आधारित प्रणाली दिखाता है। प्रोडक्शन: बैकएंड और मॉडल सर्विस जोड़ें।"
      },
      bn: {
        "app_title": "অ্যাগ্রি-অ্যাসিস্ট",
        "app_sub": "ছোট কৃষকদের জন্য ডেটা-ভিত্তিক পরামর্শ",
        "forecast_title": "ক্ষেত পূর্বাভাস",
        "forecast_sub": "প্রতি-ক্ষেত ফলন পূর্বাভাস ও সুপারিশ",
        "simulate": "+10% বৃদ্ধি দেখান",
        "upload_label": "CSV আপলোড করুন",
        "rec_title": "শীর্ষ সুপারিশ",
        "kpi_title": "কেপিআইস",
        "quick_actions": "দ্রুত কাজ",
        "add_sample": "নমুনা ডেটা লোড করুন",
        "export": "সুপারিশ এক্সপোর্ট",
        "footnote": "এই প্রোটোটাইপ ক্লায়েন্ট-সাইডে চলে এবং লোকালাইজেশন ও একটী সহজ নিয়ম-ভিত্তিক সিস্টেম প্রদর্শন করে। প্রোডাকশনে: ব্যাকএন্ড ও মডেল সার্ভিস সংযুক্ত করুন।"
      },
      te: {
        "app_title": "అగ్రిఅసిస్ట",
        "app_sub": "చిన్న రైతుల కోసం డేటా ఆధారిత సూచనలు",
        "forecast_title": "పొలాల ఊహాగానాలు",
        "forecast_sub": "ప్రతి పొలానికి ఉత్పాదకత్వ అంచనాలు మరియు సూచనలు",
        "simulate": "+10% పెంపును చూపించు",
        "upload_label": "CSV అప్లోడ్ చేయండి",
        "rec_title": "టాప్ సూచనలు",
        "kpi_title": "కేపీఐలు",
        "quick_actions": "త్వరిత చర్యలు",
        "add_sample": "సాంపిల్ డేటా లోడ్ చేయండి",
        "export": "సూచనలు ఎగుమతి చేయి",
        "footnote": "ఈ ప్రోటోటైప్ క్లయింట్-సైడ్‌లో పని చేస్తుంది మరియు స్థానికీకరణ మరియు సరళమైన నియమాల వ్యవస్థ‌ను చూపుతుంది. ప్రొడక్షన్: బ్యాక్‌ఎండ్ మరియు మోడల్ సర్వీస్‌ను కనెక్ట్ చేయండి."
      }
    };

    let LANG = 'en';
    function setLang(l) {
      LANG = l;
      const dict = I18N[l] || I18N['en'];
      // map text elements
      document.getElementById('t-app-title').innerText = dict.app_title;
      document.getElementById('t-app-sub').innerText = dict.app_sub;
      document.getElementById('t-forecast-title').innerText = dict.forecast_title;
      document.getElementById('t-forecast-sub').innerText = dict.forecast_sub;
      document.getElementById('t-simulate').innerText = dict.simulate;
      document.getElementById('t-upload-label').innerText = dict.upload_label;
      document.getElementById('t-rec-title').innerText = dict.rec_title;
      document.getElementById('t-kpi-title').innerText = dict.kpi_title;
      document.getElementById('t-quick-actions').innerText = dict.quick_actions;
      document.getElementById('t-add-sample').innerText = dict.add_sample;
      document.getElementById('t-export').innerText = dict.export;
      document.getElementById('t-footnote').innerText = dict.footnote;
    }

    // Sample in-memory dataset (fields)
    let fields = [];

    function sampleFields() {
      return [
        { field_id: 'F001', crop: 'Wheat', area_ha: 1.2, last_yield: 2800, soil_n_ppm: 8 },
        { field_id: 'F002', crop: 'Rice', area_ha: 0.8, last_yield: 4200, soil_n_ppm: 12 },
        { field_id: 'F003', crop: 'Maize', area_ha: 0.6, last_yield: 3500, soil_n_ppm: 6 }
      ];
    }

    // Very simple predictive + prescriptive logic (for demo).
    // In production: replace with model API calls.
    function predictYield(field) {
      // baseline = last_yield adjusted by soil N and a small random factor
      const nFactor = Math.min(Math.max((field.soil_n_ppm / 12), 0.6), 1.3); // normalize around typical 12 ppm
      const trend = 1.0; // placeholder for weather/season trends
      const predicted = Math.round(field.last_yield * nFactor * trend);
      return predicted;
    }

    function recommendFor(field) {
      const rec = [];
      // rule: if N < 9 recommend fertilizer application
      if (field.soil_n_ppm < 9) {
        rec.push({ type: 'Fertilizer', detail: `Apply urea ~ ${Math.round((9 - field.soil_n_ppm) * 8)} kg/ha` });
      }
      // rule: if yield low, suggest improved seed
      if (field.last_yield < 3000) {
        rec.push({ type: 'Seed', detail: 'Consider high-yield hybrid variety suited to crop' });
      }
      // irrigation suggestion placeholder
      rec.push({ type: 'Irrigation', detail: 'Check soil moisture weekly; irrigate when rootzone <50%.' });
      return rec;
    }

    function renderFields() {
      const container = document.getElementById('fieldList');
      container.innerHTML = '';
      fields.forEach(f => {
        const pred = predictYield(f);
        const uplift = Math.round(((pred - f.last_yield) / f.last_yield) * 100);
        const card = document.createElement('div');
        card.className = 'border rounded p-3 bg-slate-50';
        card.innerHTML = `
          <div class="flex justify-between items-start">
            <div>
              <div class="text-sm font-semibold">${f.field_id} — ${f.crop}</div>
              <div class="text-xs text-slate-500">Area: ${f.area_ha} ha · Last yield: ${f.last_yield} kg/ha</div>
            </div>
            <div class="text-right">
              <div class="text-xs text-slate-500">Predicted</div>
              <div class="text-lg font-bold">${pred} kg/ha</div>
              <div class="text-xs text-green-600">${uplift > 0 ? '+'+uplift+'%' : uplift+'%'} est</div>
            </div>
          </div>
        `;
        container.appendChild(card);
      });

      // KPIs
      const avgYield = fields.length ? Math.round(fields.reduce((s,f) => s + f.last_yield,0)/fields.length) : '—';
      const avgPred = fields.length ? Math.round(fields.reduce((s,f) => s + predictYield(f),0)/fields.length) : '—';
      document.getElementById('avgYield').innerText = avgYield === '—' ? '—' : avgYield + ' kg/ha';
      const upliftPct = avgYield === '—' ? '—' : Math.round(((avgPred - avgYield)/avgYield)*100);
      document.getElementById('estUplift').innerText = upliftPct === '—' ? '—' : upliftPct + ' %';
      document.getElementById('numFields').innerText = fields.length;

      renderRecommendations();
    }

    function renderRecommendations() {
      const el = document.getElementById('recommendations');
      el.innerHTML = '';
      fields.forEach(f => {
        const recs = recommendFor(f);
        const block = document.createElement('div');
        block.className = 'p-2 border rounded';
        block.innerHTML = `
          <div class="text-sm font-semibold">${f.field_id} (${f.crop})</div>
          <ul class="text-xs list-disc ml-5 mt-1"></ul>
        `;
        const ul = block.querySelector('ul');
        recs.forEach(r => {
          const li = document.createElement('li');
          li.innerText = `${r.type}: ${r.detail}`;
          ul.appendChild(li);
        });
        el.appendChild(block);
      });
    }

    function loadSampleData() {
      fields = sampleFields();
      renderFields();
    }

    function handleCSV(evt) {
      const file = evt.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        const text = e.target.result;
        const rows = text.trim().split(/\n+/).map(r => r.split(','));
        // naive parsing: expect header
        const hdr = rows.shift().map(h => h.trim());
        fields = rows.map(r => {
          const obj = {};
          r.forEach((cell,i) => obj[hdr[i]] = cell.trim());
          return {
            field_id: obj.field_id || 'F_'+Math.random().toString(36).slice(2,6),
            crop: obj.crop || 'Unknown',
            area_ha: parseFloat(obj.area_ha) || 0.5,
            last_yield: parseFloat(obj.last_yield_kg_per_ha) || 1000,
            soil_n_ppm: parseFloat(obj.soil_n_ppm) || 10
          };
        });
        renderFields();
      };
      reader.readAsText(file);
    }

    function exportCSV() {
      // simple CSV of recommendations
      const lines = ['field_id,crop,last_yield,predicted,uplift_pct,recommendations'];
      fields.forEach(f => {
        const pred = predictYield(f);
        const uplift = Math.round(((pred - f.last_yield) / f.last_yield) * 100);
        const recs = recommendFor(f).map(r => `${r.type}: ${r.detail}`).join('; ');
        lines.push(`${f.field_id},${f.crop},${f.last_yield},${pred},${uplift},"${recs}"`);
      });
      const blob = new Blob([lines.join('\n')], {type: 'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'recommendations.csv';
      a.click();
      URL.revokeObjectURL(url);
    }

    // A simple simulation that applies recommendations and shows effect (client-side demo)
    function simulateBoost() {
      // apply simple rules: if N<9, increase yield by 12% on that field; else +5% for management improvements
      fields = fields.map(f => {
        const predicted = predictYield(f);
        let boosted = predicted;
        if (f.soil_n_ppm < 9) boosted = Math.round(predicted * 1.12);
        else boosted = Math.round(predicted * 1.05);
        return {...f, simulated_predicted: boosted };
      });

      // show modal-like alert with summary (simplified)
      const avgBefore = Math.round(fields.reduce((s,f)=>s+f.last_yield,0)/fields.length);
      const avgAfter = Math.round(fields.reduce((s,f)=>s+(f.simulated_predicted||predictYield(f)),0)/fields.length);
      alert(`Estimated avg yield before: ${avgBefore} kg/ha\nAfter simulated actions: ${avgAfter} kg/ha\nEstimated uplift: ${Math.round(((avgAfter-avgBefore)/avgBefore)*100)}%`);
      renderFields();
    }

    // init
    setLang('en');
  </script>
</body>
</html>
